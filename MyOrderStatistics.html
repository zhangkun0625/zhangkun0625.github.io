<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>多产品销售数据记录</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 5px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <h2>产品销售数据输入</h2>
    <form id="dataForm">
      日期: <input type="date" id="date" /><br />
      15寸订单量: <input type="number" id="product15OrderQty" /> 销售数:
      <input type="number" id="product15SalesQty" /><br />
      18寸订单量: <input type="number" id="product18OrderQty" /> 销售数:
      <input type="number" id="product18SalesQty" /><br />
      4x10订单量: <input type="number" id="product4x10OrderQty" /> 销售数:
      <input type="number" id="product4x10SalesQty" /><br />
      <button type="button" onclick="addData()">添加数据</button>
    </form>

    <button onclick="clearAllData()">清除所有数据</button>
    <button onclick="exportData()">导出数据为JSON</button>
    <button onclick="loadSalesData()">导入数据</button>

    <h2>产品销售数据表格</h2>
    <table id="data-table">
      <thead>
        <tr>
          <th>日期</th>
          <th>15寸订单量</th>
          <th>15寸销售数</th>
          <th>18寸订单量</th>
          <th>18寸销售数</th>
          <th>4x10订单量</th>
          <th>4x10销售数</th>
          <th>15寸订单总量</th>
          <th>15寸销售总数</th>
          <th>18寸订单总量</th>
          <th>18寸销售总数</th>
          <th>4x10订单总量</th>
          <th>4x10销售总数</th>
        </tr>
      </thead>
      <tbody>
        <!-- 数据行将被动态添加到此处 -->
      </tbody>
    </table>

    <script>
      // 存储数据的数组
      let salesData = [];

      // 从本地文件加载销售数据
      function loadSalesData() {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.json';
        fileInput.onchange = function (event) {
          const file = event.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const data = JSON.parse(e.target.result);
              if (Array.isArray(data)) {
                // 只保留订单量和销售数，删除订单总量和销售总数
                salesData = data.map((entry) => ({
                  date: entry.date,
                  orderQuantity15: entry.orderQuantity15,
                  salesQuantity15: entry.salesQuantity15,
                  orderQuantity18: entry.orderQuantity18,
                  salesQuantity18: entry.salesQuantity18,
                  orderQuantity4x10: entry.orderQuantity4x10,
                  salesQuantity4x10: entry.salesQuantity4x10,
                }));
                renderTable();
              } else {
                throw new Error('数据格式不正确，应为数组格式。');
              }
            } catch (error) {
              alert(error.message);
            }
          };
          reader.readAsText(file);
        };
        fileInput.click(); // 触发点击以打开文件选择对话框
      }

      // 添加数据到表格
      function addData() {
        const date = document.getElementById('date').value;
        const quantities = {
          orderQuantity15:
            parseInt(document.getElementById('product15OrderQty').value, 10) ||
            0,
          salesQuantity15:
            parseInt(document.getElementById('product15SalesQty').value, 10) ||
            0,
          orderQuantity18:
            parseInt(document.getElementById('product18OrderQty').value, 10) ||
            0,
          salesQuantity18:
            parseInt(document.getElementById('product18SalesQty').value, 10) ||
            0,
          orderQuantity4x10:
            parseInt(
              document.getElementById('product4x10OrderQty').value,
              10
            ) || 0,
          salesQuantity4x10:
            parseInt(
              document.getElementById('product4x10SalesQty').value,
              10
            ) || 0,
        };

        // const totals = calculateTotals(quantities);
        // 不再包含订单总量和销售总数
        salesData.push({
          date: date,
          ...quantities,
          // ...totals
        });

        renderTable();
        clearInputs();
      }

      // 计算订单总量和销售总数
      function calculateTotals(newQuantities) {
        let totals = {
          totalOrders15: 0,
          totalSales15: 0,
          totalOrders18: 0,
          totalSales18: 0,
          totalOrders4x10: 0,
          totalSales4x10: 0,
        };

        salesData.forEach((entry) => {
          totals.totalOrders15 += entry.orderQuantity15;
          totals.totalSales15 += entry.salesQuantity15;
          totals.totalOrders18 += entry.orderQuantity18;
          totals.totalSales18 += entry.salesQuantity18;
          totals.totalOrders4x10 += entry.orderQuantity4x10;
          totals.totalSales4x10 += entry.salesQuantity4x10;
        });

        // Add the latest quantities to the totals
        totals.totalOrders15 += newQuantities.orderQuantity15;
        totals.totalSales15 += newQuantities.salesQuantity15;
        totals.totalOrders18 += newQuantities.orderQuantity18;
        totals.totalSales18 += newQuantities.salesQuantity18;
        totals.totalOrders4x10 += newQuantities.orderQuantity4x10;
        totals.totalSales4x10 += newQuantities.salesQuantity4x10;

        return totals;
      }

      // 清除所有数据
      function clearAllData() {
        salesData = [];
        renderTable();
        clearInputs();
      }

      // 清空输入框
      function clearInputs() {
        document.getElementById('date').value = '';
        document.getElementById('product15OrderQty').value = '';
        document.getElementById('product15SalesQty').value = '';
        document.getElementById('product18OrderQty').value = '';
        document.getElementById('product18SalesQty').value = '';
        document.getElementById('product4x10OrderQty').value = '';
        document.getElementById('product4x10SalesQty').value = '';
      }

      // 渲染表格
      function renderTable() {
        const tableBody = document
          .getElementById('data-table')
          .getElementsByTagName('tbody')[0];
        tableBody.innerHTML = ''; // 清空表格

        // 初始化累计总数
        let runningTotals = {
          totalOrders15: 0,
          totalSales15: 0,
          totalOrders18: 0,
          totalSales18: 0,
          totalOrders4x10: 0,
          totalSales4x10: 0,
        };

        // 遍历销售数据，计算每个产品的累计订单量和销售数
        salesData.forEach((entry) => {
          runningTotals.totalOrders15 += entry.orderQuantity15;
          runningTotals.totalSales15 += entry.salesQuantity15;
          runningTotals.totalOrders18 += entry.orderQuantity18;
          runningTotals.totalSales18 += entry.salesQuantity18;
          runningTotals.totalOrders4x10 += entry.orderQuantity4x10;
          runningTotals.totalSales4x10 += entry.salesQuantity4x10;

          // 为当前条目创建新的表格行
          const row = tableBody.insertRow();
          // 填充当前条目的数据
          const cells = [
            entry.date,
            entry.orderQuantity15,
            entry.salesQuantity15,
            entry.orderQuantity18,
            entry.salesQuantity18,
            entry.orderQuantity4x10,
            entry.salesQuantity4x10,
            runningTotals.totalOrders15,
            runningTotals.totalSales15,
            runningTotals.totalOrders18,
            runningTotals.totalSales18,
            runningTotals.totalOrders4x10,
            runningTotals.totalSales4x10,
          ];

          // 将数据填充到表格单元格中
          cells.forEach((text) => {
            const cell = row.insertCell();
            cell.textContent = text;
          });
        });
      }

      // 导出数据功能
      function exportData() {
        const dataStr = JSON.stringify(salesData, null, 2);
        const blob = new Blob([dataStr], {
          type: 'application/json;charset=utf-8',
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'sales-data.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    </script>
  </body>
</html>
