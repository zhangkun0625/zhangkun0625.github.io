<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>多产品销售数据记录</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 5px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <h2>产品销售数据输入</h2>
    <form id="dataForm">
      日期: <input type="date" id="date" /><br />
      15寸订单量: <input type="number" id="product15OrderQty" /> 销售数:
      <input type="number" id="product15SalesQty" /><br />
      18寸订单量: <input type="number" id="product18OrderQty" /> 销售数:
      <input type="number" id="product18SalesQty" /><br />
      4x10订单量: <input type="number" id="product4x10OrderQty" /> 销售数:
      <input type="number" id="product4x10SalesQty" /><br />
      <button type="button" onclick="addData()">添加数据</button>
    </form>

    <button onclick="clearAllData()">清除所有数据</button>
    <button onclick="exportData()">导出数据为JSON</button>
    <button onclick="importData()">导入数据</button>

    <h2>产品销售数据表格</h2>
    <table id="data-table">
      <thead>
        <tr>
          <th>日期</th>
          <th>15寸订单量</th>
          <th>15寸销售数</th>
          <th>18寸订单量</th>
          <th>18寸销售数</th>
          <th>4x10订单量</th>
          <th>4x10销售数</th>
          <th>15寸订单总量</th>
          <th>15寸销售总数</th>
          <th>18寸订单总量</th>
          <th>18寸销售总数</th>
          <th>4x10订单总量</th>
          <th>4x10销售总数</th>
        </tr>
      </thead>
      <tbody>
        <!-- 数据行将被动态添加到此处 -->
      </tbody>
    </table>

    <script>
      // 存储数据的数组
      let salesData = [];

      // 导入数据功能
      function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = function (event) {
          const file = event.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const data = JSON.parse(e.target.result);
              if (Array.isArray(data)) {
                salesData = data;
                renderTable();
                calculateTotals();
              } else {
                throw new Error('导入的数据不是有效的JSON数组。');
              }
            } catch (error) {
              alert(error.message);
            }
          };
          reader.readAsText(file);
        };
        input.click(); // 触发点击以打开文件选择对话框
      }

      // 添加数据到表格
      function addData() {
        // 收集输入数据
        const date = document.getElementById('date').value;
        const quantities = {
          orderQuantity15:
            parseInt(document.getElementById('product15OrderQty').value, 10) ||
            0,
          salesQuantity15:
            parseInt(document.getElementById('product15SalesQty').value, 10) ||
            0,
          orderQuantity18:
            parseInt(document.getElementById('product18OrderQty').value, 10) ||
            0,
          salesQuantity18:
            parseInt(document.getElementById('product18SalesQty').value, 10) ||
            0,
          orderQuantity4x10:
            parseInt(
              document.getElementById('product4x10OrderQty').value,
              10
            ) || 0,
          salesQuantity4x10:
            parseInt(
              document.getElementById('product4x10SalesQty').value,
              10
            ) || 0,
        };

        // 确保至少有一个日期被添加
        if (!date) {
          alert('请提供日期。');
          return;
        }

        // 添加新数据
        salesData.push({
          date: date,
          ...quantities,
        });

        // 清空输入框
        clearInputs();

        // 重新计算并渲染表格
        calculateTotals();
        renderTable();
      }

      // 计算订单总量和销售总数
      function calculateTotals() {
        let totals = {
          totalOrders15: 0,
          totalSales15: 0,
          totalOrders18: 0,
          totalSales18: 0,
          totalOrders4x10: 0,
          totalSales4x10: 0,
        };

        salesData.forEach((entry) => {
          totals.totalOrders15 += entry.orderQuantity15;
          totals.totalSales15 += entry.salesQuantity15;
          totals.totalOrders18 += entry.orderQuantity18;
          totals.totalSales18 += entry.salesQuantity18;
          totals.totalOrders4x10 += entry.orderQuantity4x10;
          totals.totalSales4x10 += entry.salesQuantity4x10;
        });

        // 更新销售数据数组的总计
        salesData.forEach((entry) => {
          entry.totalOrders15 = totals.totalOrders15;
          entry.totalSales15 = totals.totalSales15;
          entry.totalOrders18 = totals.totalOrders18;
          entry.totalSales18 = totals.totalSales18;
          entry.totalOrders4x10 = totals.totalOrders4x10;
          entry.totalSales4x10 = totals.totalSales4x10;
        });
      }

      // 清除所有数据
      function clearAllData() {
        salesData = [];
        renderTable();
        clearInputs();
      }

      // 清空输入框
      function clearInputs() {
        const inputs = document.querySelectorAll('#dataForm input');
        inputs.forEach((input) => (input.value = ''));
      }

      // 渲染表格
      function renderTable() {
        const tbody = document
          .getElementById('data-table')
          .getElementsByTagName('tbody')[0];
        tbody.innerHTML = ''; // 清空表格

        salesData.forEach((entry) => {
          const row = document.createElement('tr');
          Object.values(entry).forEach((text) => {
            const cell = document.createElement('td');
            cell.textContent = text;
            row.appendChild(cell);
          });
          tbody.appendChild(row);
        });
      }

      // 导出数据功能
      function exportData() {
        const dataStr = JSON.stringify(salesData, null, 2);
        const blob = new Blob([dataStr], {
          type: 'application/json;charset=utf-8',
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'sales-data.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // 初始化表格渲染
      function initialize() {
        renderTable();
      }

      // 调用初始化函数
      initialize();
    </script>
  </body>
</html>
